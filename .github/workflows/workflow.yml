name: Flutter Web

on:
  push:
    branches:
    - main

jobs:
  build:
    runs-on: ubuntu-latest 
    steps:
    - uses: actions/checkout@v2.3.4
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: subosito/flutter-action@v1.4.0
      with:
        #flutter-version: '1.12.x'
        channel: 'beta' # Currently you have to use beta channel for Flutter web.
    - run: flutter upgrade # You also get the latest flutter version
    - run: flutter config --enable-web
    - run: flutter packages get
    - run: flutter build web --release
    - run: pwd
    - run: ls
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    
    - run: cat index.html
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: sed -i '/base href/d' index.html #For MacOS : sed -i '' '/base href/d' index.html
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: cat index.html
      working-directory: /home/runner/work/aboutme/aboutme/build/web

    - run: git init
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git config user.name  "CI"
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git config user.email "flutter-ci@github.com"
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git remote add secure-origin https://${{ secrets.ACCESS_TOKEN }}@github.com/krishnakumarcn/aboutme.git
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git checkout -b gh-pages
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git add .
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git commit -m "Updated docs" --allow-empty
      working-directory: /home/runner/work/aboutme/aboutme/build/web
    - run: git push --force secure-origin gh-pages
      working-directory: /home/runner/work/aboutme/aboutme/build/web

# name: Flutter Web
# on: [push]
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v1
#     - uses: actions/setup-java@v1
#       with:
#         java-version: '12.x'
#     - uses: subosito/flutter-action@v1
#       with:
#         flutter-version: '1.25.0-8.2.pre' #'1.12.x' # you can use 1.12
#         channel: 'beta' # Currently you have to use beta channel for Flutter web.
#     - name: Upgrades flutter
#       run: flutter upgrade
#       working-directory: ./
#     - name: Enable Web
#       run: flutter config --enable-web
#       working-directory: ./
#     - name: Install dependencies
#       run: flutter packages get
#       working-directory: ./
#     - name: Build Web
#       run: flutter build web #--release
#       working-directory: ./
#     - name: Deploy
#       run: |
#         cd build/web
#         git init
#         git config user.name  "CI"
#         git config user.email "flutter-ci@github.com"
#         git remote add secure-origin https://${{ secrets.ACCESS_TOKEN }}@github.com/krishnakumarcn/aboutme.git
#         git checkout -b gh-pages
#         mkdir aboutme/
#         cd aboutme/
#         git add .
#         git commit -m "Updated docs"
#         git push --force secure-origin gh-pages
